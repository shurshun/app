amends "pkl:test"

import "../SpringApplication.pkl"
import "../renderer.pkl"
import "../vals.pkl"

local class ExampleConfig {
  username: String
  @renderer.SecretField
  password: String
  @renderer.SecretField
  accessKeys: Listing<String> = new {}
}

examples {
  ["spring application"] {
    new SpringApplication {
      resourcesRequests {
        cpu = 722
        memory = 122.mib
      }      
    }
  }
  ["spring application with jmx"] {
    new SpringApplication {
      resourcesRequests {
        cpu = 722
        memory = 122.mib
      }      
      debug = true
    }
  }
  ["spring application with secrets"] {
    new SpringApplication {
      config = new ExampleConfig {
        username = "admin"
        password = vals.sops.string("secrets.yaml", "db/password")
      }
    }
  }
  ["spring podAntiAffinityPresetSoft"] {
    new SpringApplication {
      affinity {
        podAntiAffinityConfig {
          preset = "Soft"
        }
      }
    }
  }
  ["spring podAntiAffinityPresetHard"] {
    new SpringApplication {
      affinity {
        podAntiAffinityConfig {
          preset = "Hard"
        }
      }
    }
  }
}
